import { ActionRowBuilder, ButtonBuilder, ButtonStyle, EmbedBuilder } from 'discord.js';
import type { SetupSession } from '../../../core';

export function buildStep4Embed(session: SetupSession): EmbedBuilder {
  const channelMention = session.data.globalChannelId ? `<#${session.data.globalChannelId}>` : 'Not selected';

  return new EmbedBuilder()
    .setTitle('üöÄ Bot Setup - Step 4/5')
    .setDescription('**Configuration Summary**')
    .addFields(
      {
        name: 'üìù Review Your Configuration',
        value: [
          `**Main Channel:** ${channelMention}`,
          '',
          '**Position Size Defaults:**',
          session.data.walletAddress
            ? `‚Ä¢ Wallet: \`${session.data.walletAddress.slice(0, 8)}...${session.data.walletAddress.slice(-8)}\``
            : '‚Ä¢ Wallet: Not configured',
          session.data.stopLossPercent ? `‚Ä¢ Stop Loss: ${session.data.stopLossPercent}%` : '‚Ä¢ Stop Loss: Not set',
          '',
          '**Features:**',
          `‚Ä¢ Position Display: ${session.data.positionDisplayEnabled ? '‚úÖ Enabled' : '‚ùå Disabled'}`,
          `‚Ä¢ Forward Alerts: ${session.data.forward ? '‚úÖ Enabled' : '‚ùå Disabled'}`,
        ].join('\n'),
        inline: false,
      },
      {
        name: '‚ö†Ô∏è Important',
        value:
          'Click **Confirm & Save** to finalize your configuration. You can modify these settings at any time later.',
        inline: false,
      },
    )
    .setColor(0x00ae86)
    .setFooter({ text: 'Step 4/5 ‚Ä¢ Review and confirm your configuration' });
}

export function buildStep4Components(): ActionRowBuilder<ButtonBuilder>[] {
  return [
    new ActionRowBuilder<ButtonBuilder>().addComponents(
      new ButtonBuilder()
        .setCustomId('register-process:nav:back')
        .setLabel('Back')
        .setStyle(ButtonStyle.Secondary)
        .setEmoji('‚¨ÖÔ∏è'),
      new ButtonBuilder()
        .setCustomId('register-process:step4:confirm')
        .setLabel('Confirm & Save')
        .setStyle(ButtonStyle.Success)
        .setEmoji('‚úÖ'),
      new ButtonBuilder()
        .setCustomId('register-process:nav:cancel')
        .setLabel('Cancel')
        .setStyle(ButtonStyle.Danger)
        .setEmoji('‚ùå'),
    ),
  ];
}
